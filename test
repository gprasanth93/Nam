CREATE OR REPLACE FUNCTION walfile_to_lsn(wal_file text)
RETURNS text AS $$
DECLARE
    log_file_hex text;
    segment_hex text;
    log_file_dec int;
    segment_dec int;
    lsn text;
BEGIN
    -- Extract the log file number part
    log_file_hex := substring(wal_file from 9 for 8);
    
    -- Extract the segment number part
    segment_hex := substring(wal_file from 17 for 8);
    
    -- Convert hexadecimal to decimal
    log_file_dec := ('x' || log_file_hex)::bit(32)::int;
    segment_dec := ('x' || segment_hex)::bit(32)::int;
    
    -- Combine log file number and segment number to form LSN
    lsn := log_file_dec::text || '/' || segment_dec::text;
    
    RETURN lsn;
END;
$$ LANGUAGE plpgsql;
