{
  "dashboard": {
    "id": null,
    "uid": "kvm-metrics",
    "title": "KVM Metrics",
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "panels": [
      {
        "type": "timeseries",
        "title": "CPU Usage (%)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  cpu_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  cpu_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  cpu_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  cpu_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 0,
          "y": 0,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Memory Usage (%)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  memory_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  memory_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  memory_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  memory_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 12,
          "y": 0,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Swap Usage (%)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  swap_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  swap_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  swap_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  swap_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 0,
          "y": 6,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Disk Local Usage (%)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  data_local_disk_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  data_local_disk_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  data_local_disk_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  data_local_disk_used_percent::float AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 12,
          "y": 6,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Disk Read (Bytes)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskReadBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskReadBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskReadBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskReadBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 0,
          "y": 12,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Disk Write (Bytes)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskWriteBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskWriteBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskWriteBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'diskWriteBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 12,
          "y": 12,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Network RX (Bytes)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkRxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkRxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkRxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkRxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 0,
          "y": 18,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Network TX (Bytes)",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkTxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkTxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkTxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (system_stats->>'networkTxBytes')::bigint AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 12,
          "y": 18,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Total Processes",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (process_stats->>'total')::int AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (process_stats->>'total')::int AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (process_stats->>'total')::int AS value\nFROM kvm_metrics\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  (process_stats->>'total')::int AS value\nFROM kvm_metrics\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "none"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 0,
          "y": 24,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "timeseries",
        "title": "Postgres Processes",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  count(*) FILTER (WHERE (process_stats->'list'->>0) IS NOT NULL AND (value->>'name') ILIKE '%postgres%') AS value\nFROM (\n  SELECT jsonb_array_elements(process_stats->'list') AS value, time, hostname\n  FROM kvm_metrics\n) sub\nGROUP BY time, hostname\nORDER BY time\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  count(*) FILTER (WHERE (process_stats->'list'->>0) IS NOT NULL AND (value->>'name') ILIKE '%postgres%') AS value\nFROM (\n  SELECT jsonb_array_elements(process_stats->'list') AS value, time, hostname\n  FROM kvm_metrics\n) sub\nGROUP BY time, hostname\nORDER BY time\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  count(*) FILTER (WHERE (process_stats->'list'->>0) IS NOT NULL AND (value->>'name') ILIKE '%postgres%') AS value\nFROM (\n  SELECT jsonb_array_elements(process_stats->'list') AS value, time, hostname\n  FROM kvm_metrics\n) sub\nGROUP BY time, hostname\nORDER BY time\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "time_series",
            "rawSql": "\nSELECT\n  time AS \"time\",\n  hostname AS metric,\n  count(*) FILTER (WHERE (process_stats->'list'->>0) IS NOT NULL AND (value->>'name') ILIKE '%postgres%') AS value\nFROM (\n  SELECT jsonb_array_elements(process_stats->'list') AS value, time, hostname\n  FROM kvm_metrics\n) sub\nGROUP BY time, hostname\nORDER BY time\n"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "none"
          },
          "overrides": []
        },
        "gridPos": {
          "x": 12,
          "y": 24,
          "w": 12,
          "h": 6
        }
      },
      {
        "type": "table",
        "title": "Top 10 Processes by CPU",
        "targets": [
          {
            "refId": "CN",
            "datasource": "pgmaker2_logger_cn",
            "format": "table",
            "rawSql": "\nSELECT * FROM (\n  SELECT hostname,\n         (jsonb_array_elements(process_stats->'list')->>'name') AS process,\n         (jsonb_array_elements(process_stats->'list')->>'cpu')::float AS cpu\n  FROM kvm_metrics\n) sub\nORDER BY cpu DESC\nLIMIT 10\n"
          },
          {
            "refId": "HK",
            "datasource": "pgmaker2_logger_hk",
            "format": "table",
            "rawSql": "\nSELECT * FROM (\n  SELECT hostname,\n         (jsonb_array_elements(process_stats->'list')->>'name') AS process,\n         (jsonb_array_elements(process_stats->'list')->>'cpu')::float AS cpu\n  FROM kvm_metrics\n) sub\nORDER BY cpu DESC\nLIMIT 10\n"
          },
          {
            "refId": "UK",
            "datasource": "pgmaker2_logger_uk",
            "format": "table",
            "rawSql": "\nSELECT * FROM (\n  SELECT hostname,\n         (jsonb_array_elements(process_stats->'list')->>'name') AS process,\n         (jsonb_array_elements(process_stats->'list')->>'cpu')::float AS cpu\n  FROM kvm_metrics\n) sub\nORDER BY cpu DESC\nLIMIT 10\n"
          },
          {
            "refId": "US",
            "datasource": "pgmaker2_logger_us",
            "format": "table",
            "rawSql": "\nSELECT * FROM (\n  SELECT hostname,\n         (jsonb_array_elements(process_stats->'list')->>'name') AS process,\n         (jsonb_array_elements(process_stats->'list')->>'cpu')::float AS cpu\n  FROM kvm_metrics\n) sub\nORDER BY cpu DESC\nLIMIT 10\n"
          }
        ],
        "gridPos": {
          "x": 0,
          "y": 30,
          "w": 24,
          "h": 8
        }
      }
    ],
    "templating": {
      "list": []
    },
    "annotations": {
      "list": []
    }
  },
  "overwrite": true
}
