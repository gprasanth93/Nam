DO $$
DECLARE
    json_data JSON := '[
        {"runid": "run1", "database": "db1", "passed_test": 5, "failed_test": 1, "sanity_results": {"status": "pass"}},
        {"runid": "run2", "database": "db2", "passed_test": 8, "failed_test": 0, "sanity_results": {"status": "pass"}}
    ]';
BEGIN
    INSERT INTO sanity (runid, database, passed_test, failed_test, sanity_results)
    SELECT runid, database, passed_test, failed_test, sanity_results
    FROM json_populate_recordset(NULL::sanity, json_data)
    ON CONFLICT (runid) 
    DO UPDATE SET
        database = EXCLUDED.database,
        passed_test = EXCLUDED.passed_test,
        failed_test = EXCLUDED.failed_test,
        sanity_results = EXCLUDED.sanity_results;
END $$;